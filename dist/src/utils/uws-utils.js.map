{"version":3,"sources":["../../../src/utils/uws-utils.ts"],"sourcesContent":["import { HttpRequest, HttpResponse } from 'uWebSockets.js'\n\nexport function parseBody<T>(res: HttpResponse): Promise<T> {\n  return new Promise((resolve, reject) => {\n    let buffer: Buffer\n\n    res.onData((chunk, isLast) => {\n      if (res.done) {\n        reject(new Error('Request aborted'))\n        return\n      }\n\n      const curBuf = Buffer.from(chunk)\n      buffer = buffer ? Buffer.concat([buffer, curBuf]) : isLast ? curBuf : Buffer.concat([curBuf])\n\n      if (isLast) {\n        resolve(JSON.parse(buffer.toString()) as T)\n      }\n    })\n\n    res.onAborted(() => {\n      reject(new Error('Request aborted'))\n    })\n  })\n}\n\nexport function getCookie(req: HttpRequest, res: HttpResponse, name: string): string {\n  res.cookies ??= req.getHeader('cookie')\n  return (\n    res.cookies &&\n    res.cookies.match(\n      // @ts-ignore\n      (getCookie[name] ??= new RegExp(`(^|;)\\\\s*${name}\\\\s*=\\\\s*([^;]+)`))\n    )?.[2]\n  )\n}\n"],"names":["getCookie","parseBody","res","Promise","resolve","reject","buffer","onData","chunk","isLast","done","Error","curBuf","Buffer","from","concat","JSON","parse","toString","onAborted","req","name","cookies","getHeader","match","RegExp"],"mappings":"2MA0BgBA,SAAS,mBAATA,WAxBAC,SAAS,mBAATA,aAAT,SAASA,UAAaC,GAAiB,EAC5C,OAAO,IAAIC,QAAQ,CAACC,QAASC,UAC3B,IAAIC,OAEJJ,IAAIK,MAAM,CAAC,CAACC,MAAOC,UACjB,GAAIP,IAAIQ,IAAI,CAAE,CACZL,OAAO,IAAIM,MAAM,oBACjB,MACF,CAEA,MAAMC,OAASC,OAAOC,IAAI,CAACN,OAC3BF,OAASA,OAASO,OAAOE,MAAM,CAAC,CAACT,OAAQM,OAAO,EAAIH,OAASG,OAASC,OAAOE,MAAM,CAAC,CAACH,OAAO,EAE5F,GAAIH,OAAQ,CACVL,QAAQY,KAAKC,KAAK,CAACX,OAAOY,QAAQ,IACpC,CACF,GAEAhB,IAAIiB,SAAS,CAAC,KACZd,OAAO,IAAIM,MAAM,mBACnB,EACF,EACF,CAEO,SAASX,UAAUoB,GAAgB,CAAElB,GAAiB,CAAEmB,IAAY,EACzEnB,IAAIoB,OAAO,GAAKF,IAAIG,SAAS,CAAC,UAC9B,OACErB,IAAIoB,OAAO,EACXpB,IAAIoB,OAAO,CAACE,KAAK,CAEdxB,SAAS,CAACqB,KAAK,GAAK,IAAII,OAAO,CAAC,SAAS,EAAEJ,KAAK,gBAAgB,CAAC,IACjE,CAAC,EAAE,AAEV"}